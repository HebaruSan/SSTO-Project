//Settings 
SSTOLPG{
	name = LPG
	// improvment in Isp in %
	realistic = 4
	stock = 6
	inferior = 20
	jet = 
	
	//target mass ratio for Lightweight LPG tanks
	LPGOX = 100
	LPG = 200
}

//DO NOT EDIT ANYTHING BELOW THIS LINE
@SSTOLPG[LPG]:BEFORE[SSTOLPG]{
	//convert into mutiplier
	@realistic /= 100
	@realistic += 1
	@stock /= 100
	@stock += 1
	@inferior /= 100
	@inferior += 1
	B9 = #$stock$
	@B9 += #$realistic$
	@B9 /= 2
}

RESOURCE_DEFINITION{
  name = LPG
  displayName = LPG
  abbreviation = LPG
  density = 0.00054 //540 g/l
  unitCost = 0.00256 //Calculated based on American prices for LPG - 0.4 $/l and RP-1 -125$/kg
  hsp = 2010
  flowMode = STACK_PRIORITY_SEARCH
  transfer = PUMP
  isTweakable = true
  volume = 1
}
@PART[*]:FOR[SSTOLPG]{
	isTank = 0
	isEngine = 0
	type = none
}
@PART[*]:HAS[@RESOURCE[LiquidFuel]]:FOR[SSTOLPG]{
	@isTank = 1
	@type = tank
}
@PART[*]:HAS[@RESOURCE[Oxidizer]]:FOR[SSTOLPG]{
	@isTank = 1
	@type = tank
}
@PART[*]:HAS[@MODULE[ModuleEngines*]]:FOR[SSTOLPG]{
	@isEngine = 1
	@type = engine
}
@PART[*]:HAS[#isTank[1],#isEngine[1]]:FOR[SSTOLPG]{
	@type = booster
}


+PART[*]:HAS[#type[tank]]:FOR[SSTOLPG]{ //Create tanks T
	@name = #$name$_LPGT
	%SMURFFExclude = true
}
+PART[*]:HAS[#type[engine]]:FOR[SSTOLPG]{ //Create engines E
	@name = #$name$_LPGE
	%SMURFFExclude = true
	SSTOLPG = 1.06
}
+PART[*]:HAS[#type[booster]]:FOR[SSTOLPG]{ //Create boosters B
	@name = #$name$_LPGB
	%SMURFFExclude = true
}
//===================================================================
//Handling engines
//Generate coefficients
@PART[bluedog_*_LPGE]:FOR[SSTOLPG]{ //Increased LPG improvement - BDB engines have inferior Isp, so increase by 20%
	%SSTOLPG = 1.2
}
@PART[B9_*_LPGE]:FOR[SSTOLPG]{ //Intermediate LPG improvement -both normal and high efficiency engines
	%SSTOLPG = 1.05
}
@PART[RSB*_LPGE]:FOR[SSTOLPG]{ //Realistic LPG improvement
	%SSTOLPG = 1.04
}
@PART[*_LPGE]:HAS[#manufacturer[Alcentar]]:FOR[SSTOLPG]{ //RealEngines or LCA
	%SSTOLPG = 1.06
	//Determine if using LCA pack or RealEngines - the second should improve 4%
	SSTOTMP = #$MODEL/model$
	@SSTOTMP ^= "R(.*?)k" //LCA won't match
}
@PART[*_LPGE]:HAS[#SSTOTMP[ealEnginesPac]]:FOR[SSTOLPG]{ //Realistic improvement - 4%
	%SSTOLPG = 1.04
}
@PART[*_LPGE]:FOR[SSTOLPG]{   //Apply the changes for engine - Rockets and jets, no nukes
  @MODULE[ModuleEngines*]:HAS[@PROPELLANT[LiquidFuel],@PROPELLANT[Oxidizer]]{
	//3.5:1 mass OX/LPG
	@PROPELLANT[Oxidizer]{
		@ratio = 0.7 //3.5 volumetric
	}
	@PROPELLANT[LiquidFuel]{
		@name = LPG
		@ratio = 2 //2 volumetric
	}
	
    @atmosphereCurve
    {
      k0 = #$key,0[1, ]$
      @k0 *= #$../../SSTOLPG$
      @key,0 = #0 $k0$
      
      k1 = #$key,1[1, ]$
      @k1 *= #$../../SSTOLPG$
      @key,1 = #1 $k1$
    }
  }

  @MODULE[ModuleEngines*]:HAS[@PROPELLANT[LiquidFuel],@PROPELLANT[IntakeAir]]{  //Jets
	//3.5:1 mass OX/LPG
	//
	@PROPELLANT[IntakeAir]{
		@ratio *= 1.75
	}
	@PROPELLANT[LiquidFuel]{
		@name = LPG
	}
	
    @atmosphereCurve
    {
      k0 = #$key,0[1, ]$
      @k0 *= 1.2
      @key,0 = #0 $k0$
    }
  }
}
@PART[*_LPGE]:FOR[SSTOLPG]{ //Clean up temporary distinguisher
	!SSTOTMP = delete temporary
	@title = #$title$ (LPG)
}
//===================================================================
//Handle tanks separately
@PART[*_LPGT]:HAS[@RESOURCE[LiquidFuel]]:FOR[SSTOLPG] {
	SSTOFuel = #$RESOURCE[LiquidFuel]/maxAmount$
}
@PART[*_LPGT]:HAS[@RESOURCE[Oxidizer]]:FOR[SSTOLPG] {
	SSTOFuel = #$RESOURCE[LiquidFuel]/maxAmount$
}
@PART[*_LPGT]:HAS[@RESOURCE[Oxidizer],@RESOURCE[LiquidFuel]]:FOR[SSTOLPG] {
	SSTOFuel = #$RESOURCE[LiquidFuel]/maxAmount$
	@SSTOFuel += #$RESOURCE[Oxidizer]/maxAmount$
}
@PART[*_LPGT]:FOR[SSTOLPG]{ //edit tank name and mass
	@mass *= 8
	// vvv rename the part to be meaningful vvv
	@title ^= ":rocket fuel:LPG:"
	@title ^= ":jet fuel:LPG:"
	@title ^= ":liquid fuel:LPG:"
	@title ^= ":fuel:LPG:"
}
+PART[*_LPGT]:FOR[SSTOLPG]{ //clone to create LPGox versions
	@name = #$name#OX //distinguish from LPG only tanks
	@title = #$title$ (LPGox)
	
	@mass /= #$@SSTOLPG[LPG]/LPGOX$ //LPGox dry weight, as set by user
	
	x = 0.7
	@x /= 2.7
	y = 2
	@y /= 2.7
	
	!RESOURCE[LiquidFuel]{} //remove reources only now
	!RESOURCE[Oxidizer]{} 
	RESOURCE{
		name = LPG
		amount = #$../SSTOFuel$
		@amount */ #$../y$
		maxAmount = #$amount$
	}
	RESOURCE{
		name = Oxidizer
		amount = #$../SSTOFuel$
		@amount */ #$../x$
		maxAmount = #$amount$
	}
}
@PART[*_LPGT]:FOR[SSTOLPG]{ //handle LPG only tanks
	@mass /= #$@SSTOLPG[LPG]/LPG$ //LPG dry weight, as set by user
	@title = #$name$ (LPG)
	!RESOURCE[LiquidFuel] {} //remove reources only now
	!RESOURCE[Oxidizer] {}
	RESOURCE{
		name = LPG
		amount = #$../SSTOFuel$
		@amount *= 5
		maxAmount = #$amount$
	}
}
`	

// vvv MFT COMPATIBILITY
@TANK_DEFINITION[Default]{
	TANK{
		name = LPG
		amount = 0.0
		maxAmount = 0.0
		utilization = 4.25
		note = (pressurized)
	}
}
@TANK_DEFINITION[Fuselage]{
	TANK{
		name = LPG
		amount = 0.0
		maxAmount = 0.0
		utilization = 4.25
		note = (pressurized)
	}
}
@TANK_DEFINITION[Structural]{
	TANK{
		name = LPG
		amount = 0.0
		maxAmount = 0.0
		utilization = 4.25
		note = (pressurized)
	}
}
@TANK_DEFINITION[ServiceModule]{
	TANK{
		name = LPG
		amount = 0.0
		maxAmount = 0.0
		utilization = 4.25
		note = (pressurized)
	}
}
@TANK_DEFINITION[Balloon]{
	TANK{
		name = LPG
		amount = 0.0
		maxAmount = 0.0
		utilization = 4.25
		note = (pressurized)
	}
}